# Unpacking
Using `file` command, I knew it's UPXed windows executable, so I decompressed it with UPX
# Static Analysis 
#TODO check those again
#### Basic Information
```
MD5           28955ebfce49fcd016cf4333fbe121ee
SHA1          41375dcb444eb40a8de61804b37fdc6b2decfdea
SHA256        7b97bdd52ac5992903904b66f530941021769efcc6ebd27e64b45e21dd27bda0
ssdeep        3072:UiBxhVyELxjBJOa9m8KgVrc0Hw+MFhmkpq8nbnNysyx:UiXh8ELNBJOa91zG0HY/bJ
authentihash  4542a42f79498c3194d12e0597b06e8b2596dbf2596890a198b4723e45295dea
imphash       278af6557fdb72a439b496c52749bf63
File size     197.0 KB ( 201728 bytes )
File type     Win32 EXE
Magic         literalPE32 executable for MS Windows (GUI) Intel 80386 32-bit
```

#### PE Sections
```
Name   Virtual address  Virtual size  Raw size  Entropy  MD5
.text  4096             90678         91136     6.86     46cf40ec09f67381895f1b94acacb635
.rdata 98304            17618         17920     5.07     6ac4ac18e6b46408b2f15edc419a9dda
.data  118784           25500         22016     0.96     3c4a62453793b3bdcfb892f064477764
.mysec 147456           4100          1024      0.04     f3af3dd604471ef54e7159914f6da0ec
.rsrc  155648           61016         61440     4.98     501438180c5700c4908b5c9f0d92550c
.reloc 217088           6998          7168      0.00     21eb7229dde310fab9cd2dbec6208123
 ```
 
![PS1](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/psstudio_sections.PNG)

#### PE Imports
```
[+] KERNEL32.DLL
    ├─── GetLastError
    ├─── TlsGetValue
    ├─── HeapFree
    ├─── TlsAlloc
    ├─── EnterCriticalSection
    ├─── GetConsoleOutputCP
    ├─── SetHandleCount
    ├─── LoadLibraryW
    ├─── GetOEMCP
    ├─── LCMapStringA
    ├─── IsDebuggerPresent
    ├─── GetTickCount
    ├─── SetProcessShutdownParameters
    ├─── SetFileApisToANSI
    ├─── GetEnvironmentStringsW
    ├─── GetModuleFileNameA
    ├─── SetConsoleOutputCP
    ├─── RtlUnwind
    ├─── LoadLibraryA
    ├─── GetStdHandle
    ├─── DeleteCriticalSection
    ├─── FlushViewOfFile
    ├─── EnumSystemLocalesA
    ├─── GetLocaleInfoA
    ├─── HeapSize
    ├─── GetCurrentProcessId
    ├─── LCMapStringW
    ├─── UnhandledExceptionFilter
    ├─── GetCommandLineW
    ├─── IsValidCodePage
    ├─── GetCPInfo
    ├─── ExitProcess
    ├─── GetCPInfoExA
    ├─── MultiByteToWideChar
    ├─── GetStartupInfoW
    ├─── FreeEnvironmentStringsW
    ├─── InitializeCriticalSectionAndSpinCount
    ├─── GetProcAddress
    ├─── GetProfileSectionA
    ├─── GetUserDefaultLCID
    ├─── AddAtomW
    ├─── GetLocaleInfoW
    ├─── GetStartupInfoA
    ├─── EnumResourceLanguagesW
    ├─── RaiseException
    ├─── WideCharToMultiByte
    ├─── GetModuleFileNameW
    ├─── TlsFree
    ├─── LeaveCriticalSection
    ├─── SetUnhandledExceptionFilter
    ├─── WriteFile
    ├─── GetCurrentProcess
    ├─── GetStringTypeA
    ├─── CloseHandle
    ├─── GetSystemTimeAsFileTime
    ├─── IsValidLocale
    ├─── GetACP
    ├─── HeapReAlloc
    ├─── GetStringTypeW
    ├─── GetModuleHandleW
    ├─── GetConsoleSelectionInfo
    ├─── HeapAlloc
    ├─── LocalFree
    ├─── TerminateProcess
    ├─── CreateProcessA
    ├─── QueryPerformanceCounter
    ├─── GetProcessShutdownParameters
    ├─── InitializeCriticalSection
    ├─── HeapCreate
    ├─── VirtualFree
    ├─── InterlockedDecrement
    ├─── Sleep
    ├─── GetFileType
    ├─── TlsSetValue
    ├─── GlobalGetAtomNameA
    ├─── GetCurrentThreadId
    ├─── InterlockedIncrement
    ├─── VirtualAlloc
    ├─── RemoveVectoredExceptionHandler
    ├─── SetLastError
    └─── SetConsoleTextAttribute

[+] GDI32.dll
    ├─── BeginPath
    └─── AddFontResourceExA

[+] MSIMG32.dll
    └─── TransparentBlt

[+] ole32.dll
    └─── IsAccelerator
```

#### VirusTotal Scan

![VT1](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/VT1.PNG)
![VT2](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/VT2.PNG)
![VT3](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/VT3.PNG)

#### Malicious Indicators

![PS2](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/psstudio_indicators.PNG)

#### Static Analysis Summery

1) The file is a x86 windows binary, with a unique section called `.mysec`</br>
2) The export-table directory is invalid</br>
a) What's export-table ?</br>
└─── According to [msdn](https://docs.microsoft.com/en-us/windows/desktop/debug/pe-format#export-directory-table), ```The export directory table contains address information that is used to resolve imports to the entry points within this image.```, So It's a table holding the addresses of different entrypoints (excluding the main entrypoint) so a malware author can execute some functions even before the main entrypoint by misusing it</br>
b) Why **Invalid export-table directory** is considered to be Malicious ?</br>
└─── Because It's a Known anti-debugging method, as an invalid export table will have invalid addresses, so at debugging time it will cause the debugger to get memory read error, for example at IDA I got this

![ida_error](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/ida_error.PNG)

And at x32dbg I got

![x32dbg_error](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/x32dbg_error.PNG)

3) How to bypass this ?</br>
└─── I used PEBear to remove the entire export table (setting its address and size to be zeros)</br>

![pe_bear](https://github.com/d35ha/MalwareAnalysisReports/raw/master/dc9308fbde3d3d77cfe16b96f002a08f/Image/pe_bear.PNG)

Now we can debug it without problems</br>

# Behaviour Analysis

*All the behaviour analysis was done with administrative privileges*

#### Process activity

On x64 system
```
<sample> [<sample path>] [a8ad94635df5765bf48c402675241ced] [terminated]
  └─── winsvcs.exe [C:\Windows\608707440560080\winsvcs.exe] [a8ad94635df5765bf48c402675241ced]
         ├─── 2546631960.exe [C:\Users\ADMINI~1\AppData\Local\Temp\2546631960.exe] [6de4bce11266a82bd415d2a71ba6fee5] [terminated]
         ├─── 3861828847.exe [C:\Users\ADMINI~1\AppData\Local\Temp\3861828847.exe] [d5a5deeacd3f51523092967b7a011804]
         │      └─── notepad.exe [C:\Windows\notepad.exe -c C:\ProgramData\ADwXcSSGvY\cfg] [b32189bdff6e577a92baa61ad49264e6] [high cpu usage]
         └─── 3677332584.exe [C:\Users\ADMINI~1\AppData\Local\Temp\3677332584.exe] [1b601df86b36e9166650fde2ee8c1f06] [terminated]
                └─── winsvcs.exe [C:\Windows\9889597959906\winsvcs.exe] [1b601df86b36e9166650fde2ee8c1f06]
                
```

On x86 system
```
<sample> [<sample path>] [a8ad94635df5765bf48c402675241ced] [terminated]
  └─── winsvcs.exe [C:\Windows\608707440560080\winsvcs.exe] [a8ad94635df5765bf48c402675241ced]
         ├─── 2635424568.exe [C:\Users\ADMINI~1\AppData\Local\Temp\2635424568.exe] [6de4bce11266a82bd415d2a71ba6fee5] [terminated]
         ├─── 1126665688.exe [C:\Users\ADMINI~1\AppData\Local\Temp\1126665688.exe] [d5a5deeacd3f51523092967b7a011804]
         │      └─── wuapp.exe [C:\Windows\System32\wuapp.exe -c C:\ProgramData\ADwXcSSGvY\cfg] [a576c6f36a6bd456aa221599c65b3df6] [high cpu usage]
         └─── 3695548698.exe [C:\Users\ADMINI~1\AppData\Local\Temp\3695548698.exe] [1b601df86b36e9166650fde2ee8c1f06] [terminated]
                └─── winsvcs.exe [C:\Windows\9889597959906\winsvcs.exe] [1b601df86b36e9166650fde2ee8c1f06]
```
